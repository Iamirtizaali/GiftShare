<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>GiftShare Signup</title>
  <link rel="stylesheet" href="../css/signup2nd.css">
</head>

<body>
  <div class="main-container">
    <div class="form-container">
      <h1>Welcome <span id="user-name"></span></h1>
      <p>Just a click away...</p>
      <form>
        <label for="phone">Phone Number</label>
        <input type="text" id="phone" name="phone" placeholder="Enter your phone number" required>

        <label for="address">Address</label>
        <input type="text" id="address" name="address" placeholder="Enter your address" required>

        <div class="radio-group">
          <input type="radio" id="receiver" name="role" value="Receiver" required>
          <label for="receiver">Receiver</label>

          <input type="radio" id="donor" name="role" value="Donor" required>
          <label for="donor">Donor</label>
        </div>

        <div class="checkbox-group">
          <input type="checkbox" id="terms" name="terms" required>
          <label for="terms">Agree to <a href="#">privacy and terms of use</a></label>
        </div>

        <button type="submit" class="signup-button" id="signup-btn">Sign Up</button>
      </form>
    </div>
    <div class="image-container">
      <img src="../../Images/signup 2nd.jpg" alt="Donate Box">
    </div>
  </div>

  <script>
    document.addEventListener('DOMContentLoaded', () => {
        // Retrieve data from localStorage
        const storedData = JSON.parse(localStorage.getItem('signupData'));

        // Display the user's name in the heading
        const userNameElement = document.getElementById('user-name');
        if (storedData && storedData.name) {
            userNameElement.textContent = storedData.name; // Display user's name
        } else {
            userNameElement.textContent = 'User'; // Default fallback
        }

        // Handle form submission
        const signupButton = document.getElementById('signup-btn');
        signupButton.addEventListener('click', (event) => {
            event.preventDefault(); // Prevent form submission

            // Collect data from the second form
            const phone = document.getElementById('phone').value;
            const address = document.getElementById('address').value;
            const role = document.querySelector('input[name="role"]:checked')?.value;

            if (!role) {
                alert("Please select your role (Receiver or Donor).");
                return;
            }

            // Combine data from both forms
            const completeData = { ...storedData, phone, address, role };

            // Send data to the server
            fetch('http://localhost:4000/api/auth/signup', {
                method: 'POST',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(completeData),
            })
                .then((res) => res.text())
                .then((message) => {
                    console.log(message);
                    alert("Signup successful!");
                    window.location.href = 'success.html'; // Redirect to success page
                })
                .catch((err) => console.error(err));
        });
    });
</script>

</body>

</html>
